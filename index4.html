<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Gá»­i Äáº·ng Huyá»n Trang â¤ï¸</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* --- Cáº¤U HÃŒNH CÆ  Báº¢N --- */
body {
    margin: 0;
    height: 100vh;
    /* Ná»n chuyá»ƒn mÃ u há»“ng lÃ£ng máº¡n */
    background: linear-gradient(135deg, #ff6a88, #ff99ac);
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    font-family: 'Segoe UI', sans-serif;
    color: white;
    text-align: center;
}

/* --- CANVAS PHÃO HOA --- */
#canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 1; /* Náº±m dÆ°á»›i ná»™i dung */
    pointer-events: none; /* KhÃ´ng cháº·n click chuá»™t */
}

/* --- Ná»˜I DUNG CHÃNH --- */
#content {
    display: none;
    padding: 20px;
    z-index: 10; /* Náº±m trÃªn phÃ¡o hoa */
    position: relative;
}

/* NÃºt báº¥m ban Ä‘áº§u */
#start {
    font-size: 1.4em;
    padding: 20px 30px;
    border: 2px solid #fff;
    border-radius: 15px;
    cursor: pointer;
    background: rgba(255,255,255,0.2);
    z-index: 20;
    animation: pulse 1.5s infinite;
    user-select: none;
}
@keyframes pulse { 50% { transform: scale(1.05); } }

h1 { animation: glow 2s infinite alternate; }
@keyframes glow { to { text-shadow: 0 0 25px #ff0033; } }

.images img {
    width: 130px; height: 130px;
    border-radius: 15px;
    margin: 8px;
    object-fit: cover;
    border: 3px solid #fff;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

/* --- POPUP Lá»œI NHáº®N --- */
#popup {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center; align-items: center;
    z-index: 99;
}
.popup-box {
    background: #fff; color: #ff3366;
    padding: 25px; border-radius: 20px;
    font-size: 1.4em;
    box-shadow: 0 0 20px rgba(255,255,255,0.5);
}

/* --- TIM BAY --- */
.heart {
    position: fixed; bottom: -20px;
    animation: floatUp 6s linear infinite;
    z-index: 5;
    opacity: 0.8;
}
@keyframes floatUp { to { transform: translateY(-110vh); opacity: 0; } }

#qrcode {
    margin: 15px auto; background: white;
    padding: 10px; border-radius: 12px; width: max-content;
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<div id="start">ğŸ‘‰ Cháº¡m vÃ o Ä‘Ã¢y nÃ¨ pÃ© iu ğŸ’–</div>

<div id="content">
    <h1>ğŸ‰ ChÃºc má»«ng sinh nháº­t ğŸ‰<br>Äáº·ng Huyá»n Trang ğŸ’•</h1>

    <div class="images">
        <img src="https://iili.io/f84P5wF.md.png" alt="áº¢nh 1">
        <img src="https://iili.io/f84icb9.md.png" alt="áº¢nh 2">
    </div>

    <p style="font-size: 1.1em; line-height: 1.6;">
        PÃ© iu cá»§a anh ğŸ¥°<br>
        ChÃºc em tuá»•i má»›i luÃ´n xinh Ä‘áº¹p, háº¡nh phÃºc âœ¨<br>
        VÃ  luÃ´n yÃªu Ä‘á»i nhÆ° cÃ¡ch anh yÃªu em ğŸ˜˜
    </p>

    <h3>â³ Sinh nháº­t Ä‘áº¿n sau:</h3>
    <div id="countdown" style="font-weight:bold; font-size:1.2em;"></div>

    <h2 id="preCountdown" style="display:none; font-size:3em; color:#fff000;"></h2>
    <h2 id="endMessage" style="display:none; font-size:1.6em; color:#fff000;">
        Anh chÃºc Trang sinh nháº­t tháº­t háº¡nh phÃºc â¤ï¸
    </h2>

    <div style="margin-top:20px;">
        <small>QuÃ©t QR Ä‘á»ƒ má»Ÿ trÃªn Ä‘iá»‡n thoáº¡i</small>
        <div id="qrcode"></div>
    </div>
</div>

<div id="popup">
    <div class="popup-box">ğŸ’Œ Anh yÃªu em Trang â¤ï¸</div>
</div>

<audio id="music">
    <source src="https://cdn.pixabay.com/audio/2022/10/30/audio_0a6b7f0c7f.mp3" type="audio/mpeg">
</audio>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
/* --- 1. LOGIC GIAO DIá»†N CHÃNH --- */
const start = document.getElementById("start");
const content = document.getElementById("content");
const popup = document.getElementById("popup");
const music = document.getElementById("music");
const pre = document.getElementById("preCountdown");
const endMsg = document.getElementById("endMessage");

// Kiá»ƒm tra xem cÃ³ pháº£i má»Ÿ tá»« QR khÃ´ng
const fromQR = new URLSearchParams(location.search).get("qr");

if(fromQR){
    // Náº¿u quÃ©t QR, váº«n hiá»‡n nÃºt Start Ä‘á»ƒ Ä‘áº£m báº£o nháº¡c cháº¡y Ä‘Æ°á»£c trÃªn iPhone
    // NhÆ°ng cÃ³ thá»ƒ thay Ä‘á»•i text má»™t chÃºt náº¿u thÃ­ch
}

start.onclick = () => {
    start.style.display = "none";
    content.style.display = "block";
    launchEffect();
};

function launchEffect(){
    // Hiá»‡n popup lá»i nháº¯n nhanh
    popup.style.display = "flex";
    setTimeout(() => popup.style.display = "none", 2500);

    // Báº¯t Ä‘áº§u cÃ¡c hiá»‡u á»©ng
    setInterval(createHeart, 400); // Tim bay
    startFireworks(); // PhÃ¡o hoa canvas má»›i
    
    // Kiá»ƒm tra ngÃ y Ä‘á»ƒ phÃ¡t nháº¡c
    const today = new Date();
    // ThÃ¡ng trong JS báº¯t Ä‘áº§u tá»« 0 (thÃ¡ng 1 lÃ  0)
    const isTestDay = (today.getDate() === 14 && today.getMonth() === 0); 
    const isBirthday = (today.getDate() === 15 && today.getMonth() === 0);

    // Náº¿u lÃ  hÃ´m nay (test) hoáº·c ngÃ y mai (sinh nháº­t) thÃ¬ cháº¡y nháº¡c
    if(isTestDay || isBirthday){
        startBirthdayMusic();
    } else {
        // Náº¿u khÃ´ng pháº£i ngÃ y sinh nháº­t, váº«n cho nháº¡c cháº¡y nháº¹ nhÃ ng náº¿u muá»‘n
        music.play();
    }
}

function startBirthdayMusic(){
    let c = 3; // Äáº¿m ngÆ°á»£c 3 giÃ¢y trÆ°á»›c khi nháº¡c cao trÃ o
    pre.style.display = "block";
    pre.innerText = c;

    const t = setInterval(() => {
        c--;
        if(c > 0){
            pre.innerText = c;
        } else {
            clearInterval(t);
            pre.innerText = "ğŸ‰ Happy Birthday! ğŸ‰";
            music.play(); // Báº¯t Ä‘áº§u nháº¡c
            
            // Sau khi hiá»‡n chá»¯ Happy Birthday 3s thÃ¬ chuyá»ƒn sang lá»i chÃºc
            setTimeout(() => {
                pre.style.display = "none";
                endMsg.style.display = "block";
            }, 3000);
        }
    }, 1000);
}

// Táº¡o tim bay
function createHeart(){
    const h = document.createElement("div");
    h.className = "heart";
    h.innerHTML = "â¤ï¸";
    h.style.left = Math.random() * 100 + "vw";
    h.style.fontSize = Math.random() * 20 + 15 + "px";
    h.style.animationDuration = Math.random() * 2 + 3 + "s"; // Bay tá»‘c Ä‘á»™ ngáº«u nhiÃªn
    document.body.appendChild(h);
    setTimeout(() => h.remove(), 6000);
}

// Äáº¿m ngÆ°á»£c ngÃ y 15/01
const now = new Date();
let birthday = new Date(now.getFullYear(), 0, 15);
if(birthday < now) birthday = new Date(now.getFullYear() + 1, 0, 15);

setInterval(() => {
    const d = birthday - new Date();
    const days = Math.floor(d / 86400000);
    const hours = Math.floor((d % 86400000) / 3600000);
    const minutes = Math.floor((d % 3600000) / 60000);
    document.getElementById("countdown").innerText = 
        `${days} ngÃ y ${hours} giá» ${minutes} phÃºt`;
}, 1000);

// Táº¡o QR Code
new QRCode(document.getElementById("qrcode"), {
    text: location.origin + location.pathname + "?qr=1",
    width: 120, height: 120,
    colorDark : "#ff3366", colorLight : "#ffffff"
});


/* --- 2. Há»† THá»NG PHÃO HOA CANVAS (NÃ‚NG Cáº¤P) --- */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
let cw = window.innerWidth;
let ch = window.innerHeight;
canvas.width = cw;
canvas.height = ch;

// Resize canvas khi Ä‘á»•i kÃ­ch thÆ°á»›c mÃ n hÃ¬nh
window.addEventListener('resize', () => {
    cw = window.innerWidth;
    ch = window.innerHeight;
    canvas.width = cw;
    canvas.height = ch;
});

let fireworks = [];
let particles = [];
let hue = 120;
let timerTotal = 30; // Tá»‘c Ä‘á»™ báº¯n (cÃ ng nhá» báº¯n cÃ ng dÃ y)
let timerTick = 0;

function random(min, max) { return Math.random() * (max - min) + min; }

class Firework {
    constructor(sx, sy, tx, ty) {
        this.x = sx; this.y = sy;
        this.sx = sx; this.sy = sy;
        this.tx = tx; this.ty = ty;
        this.distanceToTarget = Math.sqrt(Math.pow(tx - sx, 2) + Math.pow(ty - sy, 2));
        this.distanceTraveled = 0;
        this.coordinates = [];
        this.coordinateCount = 3;
        while(this.coordinateCount--) { this.coordinates.push([this.x, this.y]); }
        this.angle = Math.atan2(ty - sy, tx - sx);
        this.speed = 2;
        this.acceleration = 1.05;
        this.brightness = random(60, 80); // Äá»™ sÃ¡ng
        this.targetRadius = 1;
    }
    update(index) {
        this.coordinates.pop();
        this.coordinates.unshift([this.x, this.y]);
        this.targetRadius < 8 ? this.targetRadius += 0.3 : this.targetRadius = 1;
        this.speed *= this.acceleration;
        let vx = Math.cos(this.angle) * this.speed;
        let vy = Math.sin(this.angle) * this.speed;
        this.distanceTraveled = Math.sqrt(Math.pow(this.sx - this.x - vx, 2) + Math.pow(this.sy - this.y - vy, 2));
        if(this.distanceTraveled >= this.distanceToTarget) {
            createParticles(this.tx, this.ty);
            fireworks.splice(index, 1);
        } else {
            this.x += vx; this.y += vy;
        }
    }
    draw() {
        ctx.beginPath();
        ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
        ctx.lineTo(this.x, this.y);
        ctx.strokeStyle = 'hsl(' + hue + ', 100%, ' + this.brightness + '%)';
        ctx.stroke();
    }
}

class Particle {
    constructor(x, y) {
        this.x = x; this.y = y;
        this.coordinates = [];
        this.coordinateCount = 5;
        while(this.coordinateCount--) { this.coordinates.push([this.x, this.y]); }
        this.angle = random(0, Math.PI * 2);
        this.speed = random(1, 10);
        this.friction = 0.95;
        this.gravity = 1;
        this.hue = random(hue - 50, hue + 50);
        this.brightness = random(50, 80);
        this.alpha = 1;
        this.decay = random(0.015, 0.03);
    }
    update(index) {
        this.coordinates.pop();
        this.coordinates.unshift([this.x, this.y]);
        this.speed *= this.friction;
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed + this.gravity;
        this.alpha -= this.decay;
        if(this.alpha <= this.decay) { particles.splice(index, 1); }
    }
    draw() {
        ctx.beginPath();
        ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
        ctx.lineTo(this.x, this.y);
        ctx.strokeStyle = 'hsla(' + this.hue + ', 100%, ' + this.brightness + '%, ' + this.alpha + ')';
        ctx.stroke();
    }
}

function createParticles(x, y) {
    let particleCount = 40; // Sá»‘ lÆ°á»£ng háº¡t phÃ¡o hoa ná»• ra
    while(particleCount--) { particles.push(new Particle(x, y)); }
}

function loop() {
    requestAnimationFrame(loop);
    hue += 0.5;
    
    // Táº¡o hiá»‡u á»©ng má» dáº§n (trails) thay vÃ¬ xÃ³a sáº¡ch
    ctx.globalCompositeOperation = 'destination-out';
    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)'; // Äá»™ má» cá»§a Ä‘uÃ´i phÃ¡o hoa
    ctx.fillRect(0, 0, cw, ch);
    
    ctx.globalCompositeOperation = 'lighter'; // Trá»™n mÃ u cho rá»±c rá»¡

    let i = fireworks.length;
    while(i--) {
        fireworks[i].draw();
        fireworks[i].update(i);
    }
    let j = particles.length;
    while(j--) {
        particles[j].draw();
        particles[j].update(j);
    }

    if(timerTick >= timerTotal) {
        // Báº¯n phÃ¡o hoa tá»« dÆ°á»›i lÃªn, Ä‘Ã­ch Ä‘áº¿n ngáº«u nhiÃªn
        fireworks.push(new Firework(cw / 2, ch, random(0, cw), random(0, ch / 2)));
        timerTick = 0;
    } else {
        timerTick++;
    }
}

// HÃ m kÃ­ch hoáº¡t phÃ¡o hoa
function startFireworks() {
    loop();
}
</script>

</body>
</html>
